(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-h5-equipment-manage-equipment-manage"],{"07e0":function(e,t,n){"use strict";n.r(t);var a=n("0d9f"),o=n("573e");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var l,r=n("f0c5"),u=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"3fd95455",null,!1,a["a"],l);t["default"]=u.exports},"0d9f":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("h5-header"),n("el-container",{staticStyle:{border:"1px solid #eee"}},[n("el-aside",{attrs:{width:"200px"}},[n("el-menu",{attrs:{"default-openeds":["1"],"default-active":"1-1","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[n("el-submenu",{attrs:{index:"1"}},[n("template",{slot:"title"},[n("i",{staticClass:"el-icon-menu"}),e._v("设备管理")]),n("el-menu-item-group",[n("el-menu-item",{attrs:{index:"1-1"}},[e._v("设备清单")]),n("el-menu-item",{attrs:{index:"1-2"}},[e._v("添加设备")])],1)],2)],1)],1),n("h5-equipment-list")],1)],1)},i=[]},"34d1":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("ed3f"),o=n("3f0a"),i={name:"H5EquipmentList",data:function(){return{equipmentData:[],currentPage:1,total:0,pageSize:a.PAGE_SIZE,modifyDialogVisible:!1,newEquipmentInfo:{},equipmentInfo:[{key:"department",title:"部门",value:""},{key:"system",title:"所属系统",value:""},{key:"maintenance",title:"维保",value:""},{key:"machine_room",title:"机房",value:""},{key:"address",title:"机房地址",value:""},{key:"cabinet",title:"机柜",value:""},{key:"name",title:"设备名称",value:""},{key:"type",title:"设备类型",value:""},{key:"model",title:"设备型号",value:""},{key:"producer",title:"生产商",value:""},{key:"serial_number",title:"序列号",value:""},{key:"versions",title:"软件版本",value:""},{key:"manage_ip",title:"管理IP",value:""},{key:"heap_number",title:"堆叠数量",value:""},{key:"grade",title:"设备等级",value:""},{key:"form",title:"网络结构",value:""},{key:"remarks",title:"备注",value:""},{key:"power_supply",title:"电源",value:""}]}},mounted:function(){var e=this;(0,o.getEquipmentInfo)(1).then((function(t){e.equipmentData=t.result.data})),(0,o.getEquipmentCount)().then((function(t){e.total=t.result.total}))},methods:{modifyDialogCommit:function(){var t=this;e.log(this.newEquipmentInfo),delete this.newEquipmentInfo._id,(0,o.updateEquipmentInfoBySerialNum)(this.newEquipmentInfo.serial_number,this.newEquipmentInfo).then((function(n){e.log(n),t.modifyDialogVisible=!1,(0,o.getEquipmentInfo)(t.currentPage).then((function(n){e.log(n.result.data),t.equipmentData=n.result.data})),t.$notify({title:"修改成功",duration:2e3,type:"success",position:"bottom-right"})})).catch((function(t){return e.log(t)}))},handleEdit:function(t,n){e.log(t,n),this.newEquipmentInfo=n,this.modifyDialogVisible=!0},handleDelete:function(t,n){var a=this;e.log(t,n),(0,o.deleteEquipmentInfoById)(n._id).then((function(t){e.log(t),e.log(a.currentPage),(0,o.getEquipmentInfo)(a.currentPage).then((function(t){e.log(t.result.data),a.equipmentData=t.result.data})),(0,o.getEquipmentCount)().then((function(e){a.total=e.result.total}))})).catch((function(t){e.log(t)}))},prevPage:function(t){var n=this;this.currentPage=t,(0,o.getEquipmentInfo)(t).then((function(t){e.log(t.result.data),n.equipmentData=t.result.data}))},nextPage:function(t){var n=this;this.currentPage=t,(0,o.getEquipmentInfo)(t).then((function(t){e.log(t.result.data),n.equipmentData=t.result.data}))},handleCurrentChange:function(t){var n=this;this.currentPage=t,e.log(t),(0,o.getEquipmentInfo)(t).then((function(t){e.log(t.result.data),n.equipmentData=t.result.data}))}}};t.default=i}).call(this,n("5a52")["default"])},"3f0a":function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEquipmentInfoById=t.updateEquipmentInfoBySerialNum=t.getEquipmentInfoByDep=t.getEquipmentInfo=t.getEquipmentCount=t.addEquipmentInfo=t.getEquipmentBySerialNumber=void 0;var o=n("ed3f"),i=e.database(),l=i.collection("equipments"),r=function(e){return l.where({serial_number:e}).get()};t.getEquipmentBySerialNumber=r;var u=function(){return l.count()};t.getEquipmentCount=u;var s=function(e){return a.log(o.PAGE_SIZE),l.skip(o.PAGE_SIZE*(e-1)).limit(o.PAGE_SIZE).orderBy("_id","desc").get()};t.getEquipmentInfo=s;var c=function(e,t){return l.where({department:e}).skip(100*(t-1)).limit(100).orderBy("_id","desc").get()};t.getEquipmentInfoByDep=c;var f=function(e){return l.add(e)};t.addEquipmentInfo=f;var d=function(e,t){return l.where({serial_number:e}).update(t)};t.updateEquipmentInfoBySerialNum=d;var m=function(e){return l.doc(e).remove()};t.deleteEquipmentInfoById=m}).call(this,n("a9ff")["default"],n("5a52")["default"])},"454c":function(e,t,n){"use strict";var a=n("abbf"),o=n.n(a);o.a},"4c54":function(e,t,n){"use strict";n.r(t);var a=n("d81a"),o=n("6331");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("c2c2");var l,r=n("f0c5"),u=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"15dd7db8",null,!1,a["a"],l);t["default"]=u.exports},"573e":function(e,t,n){"use strict";n.r(t);var a=n("ee93"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},6331:function(e,t,n){"use strict";n.r(t);var a=n("34d1"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"63b7":function(e,t,n){var a=n("e2a0");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("b661eef8",a,!0,{sourceMap:!1,shadowMode:!1})},"98c6":function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"H5Header",data:function(){return{changePswDialog:!1,nickName:"",avatarUrl:"",wxName:"",form:{oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""},formLabelWidth:"120px"}},mounted:function(){var e=uni.getStorageSync("user_info");this.nickName=e.nickname,this.avatarUrl=e.avatarUrl,this.wxName=e.wxname},methods:{changePswCommit:function(){var t=this;e.log("修改密码提交"),this.form.newPsw===this.form.newPswConfirm?(e.log("调用修改接口"),n.callFunction({name:"user-center",data:{action:"updatePwd",params:{oldPassword:this.form.oldPsw,newPassword:this.form.newPsw}},success:function(n){e.log("res",n),0==n.result.code?(e.log("更新成功"),uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),t.changePswDialog=!1,t.$notify({title:"修改成功",duration:2e3,type:"success",position:"bottom-right"}),setTimeout((function(){uni.navigateTo({url:"/pages/login/login"})}),1e3)):(t.$notify({title:"错误",duration:2e3,type:"error",message:n.result.message,position:"bottom-right"}),e.log(n.result.message))},fail:function(t){e.log(t),this.$notify({title:"错误",duration:2e3,type:"error",message:t,position:"bottom-right"})}})):this.form.tickMessage="两次输入的密码不一致"},backClick:function(){uni.navigateBack({})},handleCommand:function(t){e.log(t),"changePsw"===t&&(this.changePswDialog=!0,this.form={oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""}),"logout"===t&&n.callFunction({name:"user-center",data:{action:"logout"},success:function(e){uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),uni.removeStorageSync("user_info"),uni.removeStorageSync("userProfile"),uni.reLaunch({url:"/pages/login/login"})}})}}};t.default=a}).call(this,n("5a52")["default"],n("a9ff")["default"])},a9b9:function(e,t,n){"use strict";n.r(t);var a=n("e608"),o=n("b7ef");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("454c");var l,r=n("f0c5"),u=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"a62ee596",null,!1,a["a"],l);t["default"]=u.exports},abbf:function(e,t,n){var a=n("befc");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("69c8c86d",a,!0,{sourceMap:!1,shadowMode:!1})},b7ef:function(e,t,n){"use strict";n.r(t);var a=n("98c6"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},befc:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".el-header[data-v-a62ee596]{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:rgba(51,51,51,.95);color:#afafaf;line-height:60px}.name[data-v-a62ee596]{padding:0 %?10?%}.back[data-v-a62ee596]{padding:%?20?%}.setting[data-v-a62ee596]{padding:%?20?%}.back[data-v-a62ee596]:hover{color:#6fe9d2}",""]),e.exports=t},c2c2:function(e,t,n){"use strict";var a=n("63b7"),o=n.n(a);o.a},d81a:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-main",[n("el-table",{attrs:{data:e.equipmentData}},[n("el-table-column",{attrs:{prop:"department",label:"部门",width:"80",fixed:!0}}),n("el-table-column",{attrs:{prop:"system",label:"区域",width:"100","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"maintenance",label:"状态",width:"80","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"machine_room",label:"机房",width:"140","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"address",label:"地址",width:"180","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"cabinet",label:"机柜",width:"100","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"name",label:"设备名称",width:"200","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"model",label:"型号",width:"180","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"producer",label:"厂家",width:"100","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"type",label:"类型",width:"100","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"serial_number",label:"序列号",width:"300","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"versions",label:"版本",width:"200","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"manage_ip",label:"管理地址",width:"160","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"grade",label:"等级",width:"80","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"form",label:"所属网络",width:"80","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{prop:"power_supply",label:"电源",width:"80","show-overflow-tooltip":!0}}),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.handleEdit(t.$index,t.row)}}}),n("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.handleDelete(t.$index,t.row)}}})]}}])})],1),n("el-pagination",{attrs:{"page-size":e.pageSize,small:!0,layout:"total, prev, pager, next",total:e.total},on:{"prev-click":function(t){arguments[0]=t=e.$handleEvent(t),e.prevPage.apply(void 0,arguments)},"next-click":function(t){arguments[0]=t=e.$handleEvent(t),e.nextPage.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.handleCurrentChange.apply(void 0,arguments)}}})],1),n("el-dialog",{attrs:{title:"修改资料",visible:e.modifyDialogVisible,width:"60%",center:!0},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.modifyDialogVisible=t}}},[n("el-form",{attrs:{model:e.newEquipmentInfo,"label-position":"right","label-width":"200rpx"}},[n("v-uni-view",{staticClass:"uni-flex equipment-info-form"},[n("v-uni-view",{staticClass:"equipment-info-item "},[e._l(e.equipmentInfo,(function(t,a){return[a%2==0?n("el-form-item",{key:t.key+"_"+t.key+"_0",attrs:{label:t.title}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.newEquipmentInfo[t.key],callback:function(n){e.$set(e.newEquipmentInfo,t.key,n)},expression:"newEquipmentInfo[item.key]"}})],1):e._e()]}))],2),n("v-uni-view",{staticClass:"equipment-info-item"},[e._l(e.equipmentInfo,(function(t,a){return[a%2==1?n("el-form-item",{key:t.key+"_"+t.key+"_0",attrs:{label:t.title}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.newEquipmentInfo[t.key],callback:function(n){e.$set(e.newEquipmentInfo,t.key,n)},expression:"newEquipmentInfo[item.key]"}})],1):e._e()]}))],2)],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.modifyDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.modifyDialogCommit.apply(void 0,arguments)}}},[e._v("确 定")])],1)],1)],1)},i=[]},e2a0:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".equipment-info-form[data-v-15dd7db8]{-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;justify-content:space-evenly}",""]),e.exports=t},e608:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("el-container",[n("el-header",{staticClass:"header uni-flex",staticStyle:{"text-align":"right","font-size":"12px"}},[n("v-uni-view",{staticClass:"back iconfont icon-shangyige",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.backClick.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"uni-flex flex-center"},[n("el-dropdown",{on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCommand.apply(void 0,arguments)}}},[n("i",{staticClass:"el-icon-setting setting",staticStyle:{"margin-right":"15px",color:"#afafaf"}}),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"changePsw"}},[e._v("修改密码")]),n("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1),e.wxName?e._e():n("span",{staticClass:"name"},[e._v(e._s(e.nickName))]),e.wxName?n("span",{staticClass:"name"},[e._v(e._s(e.wxName))]):e._e(),e.avatarUrl?n("el-avatar",{attrs:{shape:"circle",size:40,fit:"contain",src:e.avatarUrl}}):e._e()],1)],1),n("el-dialog",{attrs:{title:"修改密码",visible:e.changePswDialog,center:!0},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=t}}},[n("el-form",{attrs:{model:e.form}},[n("el-form-item",{attrs:{label:"原密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.oldPsw,callback:function(t){e.$set(e.form,"oldPsw",t)},expression:"form.oldPsw"}})],1),n("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPsw,callback:function(t){e.$set(e.form,"newPsw",t)},expression:"form.newPsw"}})],1),n("el-form-item",{attrs:{label:"确认新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPswConfirm,callback:function(t){e.$set(e.form,"newPswConfirm",t)},expression:"form.newPswConfirm"}})],1),e.form.tickMessage?n("el-form-item",{attrs:{label:"提示:","label-width":e.formLabelWidth}},[n("v-uni-text",{staticClass:"font-size-22",staticStyle:{color:"#FF3333"}},[e._v(e._s(e.form.tickMessage))])],1):e._e()],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswCommit.apply(void 0,arguments)}}},[e._v("确 定")])],1)],1)],1)],1)},i=[]},ed3f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_DEPARTMENT=t.REPORT_CYCLE=t.CYCLE=t.DEPARTMENT=t.SMS_CONFIG=t.PAGE_SIZE=t.ANALYTICS_LINE_COLOR=t.LOCATION_RADIUS=void 0;var a=5e4;t.LOCATION_RADIUS=a;var o=["#5c8cd8","#5c9f70","#e9a943","#a42516","#d155b4","#ffffff","#323864"];t.ANALYTICS_LINE_COLOR=o;var i=15;t.PAGE_SIZE=i;var l={appid:"__UNI__DC62158",smsKey:"5e0b77dc76d4f501b4fff3b7d4c68854",smsSecret:"a683377f64ff7775354fe3f1fd625a86",templateId:"12103"};t.SMS_CONFIG=l;var r=[{value:"datacenter",label:"IDC部"},{value:"network",label:"网络部"},{value:"bigdata",label:"大数据部"},{value:"cloud",label:"云平台部"},{value:"services",label:"服务台"}];t.DEPARTMENT=r;var u=[{value:"month",label:"月"},{value:"week",label:"周"},{value:"quarter",label:"季度"}];t.CYCLE=u;var s={week:"周",month:"月",quarter:"季度"};t.REPORT_CYCLE=s;var c={network:"网络部",datacenter:"IDC部",bigdata:"大数据部",cloud:"云平台部",services:"服务台"};t.REPORT_DEPARTMENT=c},ee93:function(e,t,n){"use strict";var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("a9b9")),i=a(n("4c54")),l=(n("3f0a"),{data:function(){return{}},components:{H5Header:o.default,H5EquipmentList:i.default}});t.default=l}}]);