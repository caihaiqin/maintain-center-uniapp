(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-h5-report-manage-report-manage"],{"05b9":function(e,t,n){"use strict";n.r(t);var a=n("75ab"),o=n("1a9f");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);var i,l=n("f0c5"),c=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"64847b1b",null,!1,a["a"],i);t["default"]=c.exports},"0e5f":function(e,t,n){"use strict";n.r(t);var a=n("cf12"),o=n("a960");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("6e2d");var i,l=n("f0c5"),c=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"96d264ae",null,!1,a["a"],i);t["default"]=c.exports},1951:function(e,t,n){"use strict";n.r(t);var a=n("9d8f"),o=n("bac1");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);var i,l=n("f0c5"),c=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"25d1d902",null,!1,a["a"],i);t["default"]=c.exports},"1a9f":function(e,t,n){"use strict";n.r(t);var a=n("fc30"),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},"285e":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".content[data-v-96d264ae]{padding:%?20?%}.generate-polling-report[data-v-96d264ae]{box-shadow:0 0 10px #ccc;padding:%?20?%;border-radius:%?10?%}.item[data-v-96d264ae]{margin:%?20?% 0}",""]),e.exports=t},"3f0a":function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEquipmentInfoById=t.updateEquipmentInfoBySerialNum=t.getEquipmentInfoByDep=t.getEquipmentInfo=t.getEquipmentCount=t.addEquipmentInfo=t.getEquipmentBySerialNumber=void 0;var o=n("ed3f"),r=e.database(),i=r.collection("equipments"),l=function(e){return i.where({serial_number:e}).get()};t.getEquipmentBySerialNumber=l;var c=function(){return i.count()};t.getEquipmentCount=c;var u=function(e){return a.log(o.PAGE_SIZE),i.skip(o.PAGE_SIZE*(e-1)).limit(o.PAGE_SIZE).orderBy("_id","desc").get()};t.getEquipmentInfo=u;var s=function(e,t){return i.where({department:e}).skip(100*(t-1)).limit(100).orderBy("_id","desc").get()};t.getEquipmentInfoByDep=s;var f=function(e){return i.add(e)};t.addEquipmentInfo=f;var d=function(e,t){return i.where({serial_number:e}).update(t)};t.updateEquipmentInfoBySerialNum=d;var p=function(e){return i.doc(e).remove()};t.deleteEquipmentInfoById=p}).call(this,n("a9ff")["default"],n("5a52")["default"])},"454c":function(e,t,n){"use strict";var a=n("abbf"),o=n.n(a);o.a},"4d6b":function(e,t,n){"use strict";(function(e,a){n("99af"),Object.defineProperty(t,"__esModule",{value:!0}),t.getEquipmentAndPollingList=t.getAlarmAndFaultCount=t.getEqPollingCount=t.getNetEqPollingList=t.getEquipmentInfoFault=void 0;var o=e.database(),r=o.command,i=o.collection("network-equipment-polling"),l=e.database(),c=l.collection("network-equipment-polling,equipments"),u=function(e){return i.skip(10*e).limit(10).orderBy("_id","desc").get()};t.getNetEqPollingList=u;var s=function(e,t,n){a.log("beginDate,endDate",t,n);var o=new Date(t).getTime(),r=new Date(n).getTime();a.log("newBeginDate,newEndDate",o,r,r-o);var i='serial_number.department == "'.concat(e,'" && totality=="异常" && polling_date_timestamp>').concat(o," && polling_date_timestamp<").concat(r);return a.log(i),c.where(i).field("polling_date,totality,abnormal_detail,serial_number{serial_number,department,machine_room,cabinet,model}").get()};t.getEquipmentAndPollingList=s;var f=function(){return i.count()};t.getEqPollingCount=f;var d=function(){return i.groupBy("totality").groupField("sum(alarm) as alarmCount,sum(fault) as faultCount").get()};t.getAlarmAndFaultCount=d;var p=function(e){return i.where(r.and({department:e},{totality:"异常"})).orderBy("_id","desc").get()};t.getEquipmentInfoFault=p}).call(this,n("a9ff")["default"],n("5a52")["default"])},"65cd":function(e,t,n){"use strict";var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("a9b9")),r=a(n("05b9")),i=a(n("0e5f")),l=(n("4d6b"),n("3f0a"),{data:function(){return{}},components:{H5Header:o.default,H5ProjectMonthyReport:r.default,H5EquipmentPollingReport:i.default},methods:{},onLoad:function(){}});t.default=l},"668a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.addChartsInfo=t.getChartsInfo=void 0;var n=e.database(),a=n.collection("echarts"),o=function(){return a.get()};t.getChartsInfo=o;var r=function(e){return a.add(e)};t.addChartsInfo=r}).call(this,n("a9ff")["default"])},"6e2d":function(e,t,n){"use strict";var a=n("d7fc"),o=n.n(a);o.a},"75ab":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-main",[n("el-table",{attrs:{data:e.projectMonthyReportInfo}},[n("el-table-column",{attrs:{prop:"month",label:"月份",width:"80",fixed:!0}}),n("el-table-column",{attrs:{label:"运营重点指标",align:"center"}},[e._l(Object.keys(e.targetKeys),(function(t,a){return[n("el-table-column",{key:t+"_0",attrs:{prop:e.targetKeys[t].titleProp,label:e.targetKeys[t].title,"show-overflow-tooltip":!0}}),n("el-table-column",{key:t+"_1",attrs:{prop:e.targetKeys[t].targetProp,label:e.targetKeys[t].target,"show-overflow-tooltip":!0}})]}))],2)],1),n("v-uni-button",{attrs:{type:"default"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.generate.apply(void 0,arguments)}}},[e._v("生成报表")])],1)],1)},r=[]},"98c6":function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"H5Header",data:function(){return{changePswDialog:!1,nickName:"",avatarUrl:"",wxName:"",form:{oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""},formLabelWidth:"120px"}},mounted:function(){var e=uni.getStorageSync("user_info");this.nickName=e.nickname,this.avatarUrl=e.avatarUrl,this.wxName=e.wxname},methods:{changePswCommit:function(){var t=this;e.log("修改密码提交"),this.form.newPsw===this.form.newPswConfirm?(e.log("调用修改接口"),n.callFunction({name:"user-center",data:{action:"updatePwd",params:{oldPassword:this.form.oldPsw,newPassword:this.form.newPsw}},success:function(n){e.log("res",n),0==n.result.code?(e.log("更新成功"),uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),t.changePswDialog=!1,t.$notify({title:"修改成功",duration:2e3,type:"success",position:"bottom-right"}),setTimeout((function(){uni.navigateTo({url:"/pages/login/login"})}),1e3)):(t.$notify({title:"错误",duration:2e3,type:"error",message:n.result.message,position:"bottom-right"}),e.log(n.result.message))},fail:function(t){e.log(t),this.$notify({title:"错误",duration:2e3,type:"error",message:t,position:"bottom-right"})}})):this.form.tickMessage="两次输入的密码不一致"},backClick:function(){uni.navigateBack({})},handleCommand:function(t){e.log(t),"changePsw"===t&&(this.changePswDialog=!0,this.form={oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""}),"logout"===t&&n.callFunction({name:"user-center",data:{action:"logout"},success:function(e){uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),uni.removeStorageSync("user_info"),uni.removeStorageSync("userProfile"),uni.reLaunch({url:"/pages/login/login"})}})}}};t.default=a}).call(this,n("5a52")["default"],n("a9ff")["default"])},"9d8f":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("h5-header"),n("el-container",{staticStyle:{border:"1px solid #eee"}},[n("el-aside",{attrs:{width:"200px"}},[n("el-menu",{attrs:{"default-openeds":["1"],"default-active":"1-1","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[n("el-submenu",{attrs:{index:"1"}},[n("template",{slot:"title"},[n("i",{staticClass:"el-icon-menu"}),e._v("报表管理")]),n("el-menu-item-group",[n("el-menu-item",{attrs:{index:"1-1"}},[e._v("设备巡检报告")])],1)],2)],1)],1),n("h5-equipment-polling-report")],1)],1)},r=[]},a960:function(e,t,n){"use strict";n.r(t);var a=n("f1e8"),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},a9b9:function(e,t,n){"use strict";n.r(t);var a=n("e608"),o=n("b7ef");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("454c");var i,l=n("f0c5"),c=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"a62ee596",null,!1,a["a"],i);t["default"]=c.exports},abbf:function(e,t,n){var a=n("befc");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("69c8c86d",a,!0,{sourceMap:!1,shadowMode:!1})},b7ef:function(e,t,n){"use strict";n.r(t);var a=n("98c6"),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},bac1:function(e,t,n){"use strict";n.r(t);var a=n("65cd"),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},befc:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".el-header[data-v-a62ee596]{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:rgba(51,51,51,.95);color:#afafaf;line-height:60px}.name[data-v-a62ee596]{padding:0 %?10?%}.back[data-v-a62ee596]{padding:%?20?%}.setting[data-v-a62ee596]{padding:%?20?%}.back[data-v-a62ee596]:hover{color:#6fe9d2}",""]),e.exports=t},cf12:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("v-uni-view",{staticClass:"generate-polling-report"},[n("v-uni-view",{staticClass:"item block"},[n("v-uni-text",{staticClass:"demonstration"},[e._v("日期范围：")]),n("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.datePickerChange.apply(void 0,arguments)}},model:{value:e.pickDate,callback:function(t){e.pickDate=t},expression:"pickDate"}})],1),n("v-uni-view",{staticClass:"item"},[n("el-select",{attrs:{placeholder:"请选择部门"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.departmentSelect.apply(void 0,arguments)}},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}},e._l(e.departmentList,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("v-uni-view",{staticClass:"item"},[n("el-select",{attrs:{placeholder:"请选择周期"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.cycleSelect.apply(void 0,arguments)}},model:{value:e.cycle,callback:function(t){e.cycle=t},expression:"cycle"}},e._l(e.cycleList,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("v-uni-view",{staticClass:"item"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.report.apply(void 0,arguments)}}},[e._v("生成巡检报告")])],1)],1)],1)},r=[]},d7fc:function(e,t,n){var a=n("285e");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("1c379a03",a,!0,{sourceMap:!1,shadowMode:!1})},e608:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("el-container",[n("el-header",{staticClass:"header uni-flex",staticStyle:{"text-align":"right","font-size":"12px"}},[n("v-uni-view",{staticClass:"back iconfont icon-shangyige",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.backClick.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"uni-flex flex-center"},[n("el-dropdown",{on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCommand.apply(void 0,arguments)}}},[n("i",{staticClass:"el-icon-setting setting",staticStyle:{"margin-right":"15px",color:"#afafaf"}}),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"changePsw"}},[e._v("修改密码")]),n("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1),e.wxName?e._e():n("span",{staticClass:"name"},[e._v(e._s(e.nickName))]),e.wxName?n("span",{staticClass:"name"},[e._v(e._s(e.wxName))]):e._e(),e.avatarUrl?n("el-avatar",{attrs:{shape:"circle",size:40,fit:"contain",src:e.avatarUrl}}):e._e()],1)],1),n("el-dialog",{attrs:{title:"修改密码",visible:e.changePswDialog,center:!0},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=t}}},[n("el-form",{attrs:{model:e.form}},[n("el-form-item",{attrs:{label:"原密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.oldPsw,callback:function(t){e.$set(e.form,"oldPsw",t)},expression:"form.oldPsw"}})],1),n("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPsw,callback:function(t){e.$set(e.form,"newPsw",t)},expression:"form.newPsw"}})],1),n("el-form-item",{attrs:{label:"确认新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPswConfirm,callback:function(t){e.$set(e.form,"newPswConfirm",t)},expression:"form.newPswConfirm"}})],1),e.form.tickMessage?n("el-form-item",{attrs:{label:"提示:","label-width":e.formLabelWidth}},[n("v-uni-text",{staticClass:"font-size-22",staticStyle:{color:"#FF3333"}},[e._v(e._s(e.form.tickMessage))])],1):e._e()],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswCommit.apply(void 0,arguments)}}},[e._v("确 定")])],1)],1)],1)],1)},r=[]},ed3f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_DEPARTMENT=t.REPORT_CYCLE=t.CYCLE=t.DEPARTMENT=t.SMS_CONFIG=t.PAGE_SIZE=t.ANALYTICS_LINE_COLOR=t.LOCATION_RADIUS=void 0;var a=5e4;t.LOCATION_RADIUS=a;var o=["#5c8cd8","#5c9f70","#e9a943","#a42516","#d155b4","#ffffff","#323864"];t.ANALYTICS_LINE_COLOR=o;var r=15;t.PAGE_SIZE=r;var i={appid:"__UNI__DC62158",smsKey:"5e0b77dc76d4f501b4fff3b7d4c68854",smsSecret:"a683377f64ff7775354fe3f1fd625a86",templateId:"12103"};t.SMS_CONFIG=i;var l=[{value:"datacenter",label:"IDC部"},{value:"network",label:"网络部"},{value:"bigdata",label:"大数据部"},{value:"cloud",label:"云平台部"},{value:"services",label:"服务台"}];t.DEPARTMENT=l;var c=[{value:"month",label:"月"},{value:"week",label:"周"},{value:"quarter",label:"季度"}];t.CYCLE=c;var u={week:"周",month:"月",quarter:"季度"};t.REPORT_CYCLE=u;var s={network:"网络部",datacenter:"IDC部",bigdata:"大数据部",cloud:"云平台部",services:"服务台"};t.REPORT_DEPARTMENT=s},f1e8:function(e,t,n){"use strict";(function(e){n("99af"),n("a15b"),n("ac1f"),n("1276"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("ed3f"),o={name:"H5EquipmentPollingReport",data:function(){return{pickDate:"",department:a.DEPARTMENT[0].value,departmentList:a.DEPARTMENT,cycleList:a.CYCLE,cycle:a.CYCLE[0].value,coverInfo:{year:2021,department:a.REPORT_DEPARTMENT[a.DEPARTMENT[0].value],month:5,type:"周",beginDate:"20210501",endDate:"20210507"}}},mounted:function(){},methods:{datePickerChange:function(){e.log(this.pickDate)},departmentSelect:function(){e.log(this.department),this.coverInfo.department=a.REPORT_DEPARTMENT[this.department]},cycleSelect:function(){e.log(this.cycle)},report:function(){if(e.log("生成pdf"),this.pickDate){this.coverInfo.beginDate=this.pickDate[0].split("-").join("."),this.coverInfo.endDate=this.pickDate[1].split("-").join(".");var t=this.pickDate[1].split("-")[0],n=this.pickDate[1].split("-")[1];t&&(this.coverInfo.year=t),n&&(this.coverInfo.month=n),this.coverInfo.type=a.REPORT_CYCLE[this.cycle];var o="".concat(this.department).concat(this.cycle,"Polling");uni.setStorageSync("coverInfo",this.coverInfo),uni.navigateTo({url:"/pages/h5/equipment-weekly-polling-report/equipment-weekly-polling-report?reportType=".concat(o)})}else uni.showToast({title:"请选择日期范围",icon:"none",duration:1e3})}}};t.default=o}).call(this,n("5a52")["default"])},fc30:function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("668a"),r={name:"H5ProjectMonthyReport",data:function(){return{projectMonthyReportInfo:[],targetKeys:{tech_service:{title:"技术服务单",target:"及时率",titleProp:"target_info.tech_service.titleCount",targetProp:"target_info.tech_service.targetCount"},fault_response:{title:"故障响应",target:"及时率",titleProp:"target_info.fault_response.titleCount",targetProp:"target_info.fault_response.targetCount"},backbone_network:{title:"骨干网设备可用时长",target:"及时率",titleProp:"target_info.backbone_network.titleCount",targetProp:"target_info.backbone_network.targetCount"},power_supply:{title:"电力系统可用时长",target:"及时率",titleProp:"target_info.power_supply.titleCount",targetProp:"target_info.power_supply.targetCount"}}}},methods:{generate:function(){e.callFunction({name:"generate-pdf",data:{a:1}})}},mounted:function(){var e=this;(0,o.getChartsInfo)().then((function(t){a.log(t.result.data),e.projectMonthyReportInfo=t.result.data})).catch((function(e){a.log(e)}))}};t.default=r}).call(this,n("a9ff")["default"],n("5a52")["default"])}}]);