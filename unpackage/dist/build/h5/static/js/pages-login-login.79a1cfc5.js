(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-login-login"],{"0a85":function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("v-uni-view",{staticClass:"dialog"},[n("v-uni-view",{staticClass:"logo"},[n("v-uni-image",{attrs:{src:"/static/img/login/logo.png",mode:"aspectFill"}})],1),n("v-uni-view",{},[n("v-uni-view",{staticClass:"input-item"},[n("v-uni-image",{staticClass:"input-item-image",attrs:{src:"/static/img/login/username.png",mode:"aspectFill"}}),n("v-uni-input",{staticClass:"username info",attrs:{type:"text",placeholder:"请输入用户名"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),n("v-uni-view",{staticClass:"input-item"},[n("v-uni-image",{staticClass:"input-item-image",attrs:{src:"/static/img/login/password.png",mode:"aspectFill"}}),n("v-uni-input",{staticClass:"password info",attrs:{type:"text",password:"true",placeholder:"请输入密码"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),n("v-uni-view",{staticClass:"input-item"},[n("v-uni-image",{staticClass:"input-item-image",attrs:{src:"/static/img/login/phonenum.png",mode:"aspectFill"}}),n("v-uni-input",{staticClass:"phone info",attrs:{type:"text",placeholder:"请输入手机号"},model:{value:e.phonenum,callback:function(t){e.phonenum=t},expression:"phonenum"}}),n("v-uni-button",{staticClass:"getcode",class:{isDisabled:e.isGetCodeDisable},attrs:{type:"default",disabled:e.isGetCodeDisable},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getCodeClick.apply(void 0,arguments)}}},[e._v(e._s(e.getCodeText))])],1),n("v-uni-view",{staticClass:"input-item"},[n("v-uni-image",{staticClass:"input-item-image",attrs:{src:"/static/img/login/code.png",mode:"aspectFill"}}),n("v-uni-input",{staticClass:"code info",attrs:{type:"text",placeholder:"验证码"},model:{value:e.inputCode,callback:function(t){e.inputCode=t},expression:"inputCode"}})],1)],1),n("v-uni-button",{staticClass:"login",attrs:{type:"default"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.loginH5.apply(void 0,arguments)}}},[e._v("登录")])],1)],1)},a=[]},1315:function(e,t,n){var i=n("16ea");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("4f06").default;o("dc921422",i,!0,{sourceMap:!1,shadowMode:!1})},"16ea":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,".content .dialog[data-v-499d10ee]{position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:80%;padding:%?20?%;background-color:#fff;border-radius:%?20?%;box-shadow:0 0 20px #ccc;opacity:.9}.content .dialog .logo[data-v-499d10ee]{width:100%}.content .dialog .logo uni-image[data-v-499d10ee]{width:100%}.content .dialog .input-item[data-v-499d10ee]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin:%?30?%;border-bottom:1px solid #ccc}.content .dialog .input-item-image[data-v-499d10ee]{width:%?40?%;height:%?40?%}.content .info[data-v-499d10ee]{height:%?80?%;-webkit-box-flex:1;-webkit-flex:1;flex:1}.content .username[data-v-499d10ee],\n.content .password[data-v-499d10ee],\n.content .phone[data-v-499d10ee],\n.content .code[data-v-499d10ee]{padding-left:%?20?%}.content .getcode[data-v-499d10ee]{width:%?180?%}.content .login[data-v-499d10ee]{width:100%;line-height:%?80?%;background-color:#65b0f7;color:#fff;margin-top:%?80?%}.content .getcode[data-v-499d10ee]{background-color:#65b0f7;color:#fff;font-size:%?20?%}.content .isDisabled[data-v-499d10ee]{background-color:rgba(33,35,30,.5)}",""]),e.exports=t},3689:function(e,t,n){"use strict";var i=n("5819"),o=n.n(i);o.a},5819:function(e,t,n){var i=n("6509");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n("4f06").default;o("3890f132",i,!0,{sourceMap:!1,shadowMode:!1})},6509:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"uni-page-body[data-v-499d10ee]{background-color:#f7f7f7}body.?%PAGE?%[data-v-499d10ee]{background-color:#f7f7f7}",""]),e.exports=t},"6ef5":function(e,t,n){"use strict";n.r(t);var i=n("f3b4"),o=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},"8fce":function(e,t,n){"use strict";n.r(t);var i=n("0a85"),o=n("6ef5");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("3689"),n("af28");var s,r=n("f0c5"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"499d10ee",null,!1,i["a"],s);t["default"]=u.exports},af28:function(e,t,n){"use strict";var i=n("1315"),o=n.n(i);o.a},ed3f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_DEPARTMENT=t.REPORT_CYCLE=t.CYCLE=t.DEPARTMENT=t.SMS_CONFIG=t.PAGE_SIZE=t.ANALYTICS_LINE_COLOR=t.LOCATION_RADIUS=void 0;var i=5e4;t.LOCATION_RADIUS=i;var o=["#5c8cd8","#5c9f70","#e9a943","#a42516","#d155b4","#ffffff","#323864"];t.ANALYTICS_LINE_COLOR=o;var a=15;t.PAGE_SIZE=a;var s={appid:"__UNI__DC62158",smsKey:"5e0b77dc76d4f501b4fff3b7d4c68854",smsSecret:"a683377f64ff7775354fe3f1fd625a86",templateId:"12103"};t.SMS_CONFIG=s;var r=[{value:"datacenter",label:"IDC部"},{value:"network",label:"网络部"},{value:"bigdata",label:"大数据部"},{value:"cloud",label:"云平台部"},{value:"services",label:"服务台"}];t.DEPARTMENT=r;var u=[{value:"month",label:"月"},{value:"week",label:"周"},{value:"quarter",label:"季度"}];t.CYCLE=u;var c={week:"周",month:"月",quarter:"季度"};t.REPORT_CYCLE=c;var l={network:"网络部",datacenter:"IDC部",bigdata:"大数据部",cloud:"云平台部",services:"服务台"};t.REPORT_DEPARTMENT=l},f252:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.bindUserPhone=t.updateUsersProfile=t.getUsersByGroup=void 0;var n=e.database(),i=n.collection("uni-id-users"),o=function(e){return i.where({group:e}).field("nickname").get()};t.getUsersByGroup=o;var a=function(e,t){return i.where({username:e}).update({avatarUrl:t.avatarUrl,wxname:t.wxName})};t.updateUsersProfile=a;var s=function(e,t){return i.where({username:e}).update({phonenum:t})};t.bindUserPhone=s}).call(this,n("a9ff")["default"])},f3b4:function(e,t,n){"use strict";(function(e,i){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=o(n("1da1")),s=(n("ed3f"),n("f252")),r={data:function(){return{username:"",password:"",phonenum:"",sendCode:"",inputCode:"",expiresIn:"",isGetCodeDisable:!1,getCodeText:"获取验证码",timer:""}},methods:{loginH5:function(){this.login()},loginNotH5:function(){this.inputCode?this.inputCode===this.sendCode?(e.log("当前时间",(new Date).getTime()),e.log("过期时间",this.expiresIn),(new Date).getTime()>this.expiresIn?uni.showToast({title:"验证码已过期",icon:"none"}):this.getUserProfile()):uni.showToast({title:"验证码不正确",icon:"none"}):uni.showToast({title:"请输入验证码",icon:"none"})},getCodeClick:function(){var e=(0,a.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=this.username.length){e.next=3;break}return uni.showToast({title:"请输入用户名",icon:"none"}),e.abrupt("return");case 3:if(0!=this.password.length){e.next=6;break}return uni.showToast({title:"请输入密码",icon:"none"}),e.abrupt("return");case 6:if(0!=this.phonenum.length){e.next=9;break}return uni.showToast({title:"请输入手机号",icon:"none"}),e.abrupt("return");case 9:if(this.isMobile(this.phonenum)){e.next=12;break}return uni.showToast({title:"请输入正确手机号",icon:"none"}),e.abrupt("return");case 12:uni.showToast({title:"正在验证，请稍候",icon:"none"}),this.checkUserInfo();case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setCountDown:function(){this.count=60,this.timer=setInterval(this.countDown,1e3)},countDown:function(){this.count>0?this.getCodeText=this.count--:(clearInterval(this.timer),this.isGetCodeDisable=!1,this.getCodeText="获取验证码")},getcode:function(){e.log("获取验证码"),this.isGetCodeDisable=!0;var t="00000"+Math.floor(1e6*Math.random());this.sendCode=t.substring(t.length-6),this.expiresIn=(new Date).getTime()+6e4,e.log("发送验证码",this.sendCode)},verityCode:function(){},bindPhone:function(t,n){var i=this;(0,s.bindUserPhone)(t,n).then((function(t){e.log("绑定res",t),1==t.result.updated?(uni.showToast({title:"绑定成功",icon:"none"}),e.log("发送验证码"),i.getcode()):uni.showToast({title:"绑定失败，请重试",icon:"none"})})).catch((function(e){uni.showToast({title:"绑定失败，请重试",icon:"none"})}))},isMobile:function(e){return/^1[3-9]\d{9}$/.test(e)},checkUserInfo:function(){var t=(0,a.default)(regeneratorRuntime.mark((function t(){var n,o,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.log("验证用户名 密码 手机号"),t.next=3,i.callFunction({name:"user-center",data:{action:"login",params:{username:this.username,password:this.password,needPermission:!0}}});case 3:if(n=t.sent,0!=n.result.code){t.next=10;break}e.log("用户密码验证成功"),o=n.result.userInfo,o.phonenum?o.phonenum===this.phonenum?(e.log("发送验证码"),this.getcode()):uni.showToast({icon:"none",title:"手机号非绑定号码"}):(e.log("手机号未绑定"),uni.showModal({content:"手机号未绑定，是否绑定该手机号",showCancel:!0,success:function(e){e.confirm&&a.bindPhone(o.username,a.phonenum)}})),t.next=12;break;case 10:return uni.showToast({icon:"none",title:n.result.msg}),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),getUserProfile:function(){var t=this;uni.getUserProfile?uni.getUserProfile({desc:"测试",lang:"zh_CN",success:function(t){e.log(t),uni.setStorageSync("userProfile",t.userInfo)},fail:function(t){e.log(t)},complete:function(n){e.log("mes"),t.login()}}):e.log("不支持")},login:function(){i.callFunction({name:"user-center",data:{action:"login",params:{username:this.username,password:this.password,needPermission:!0}},success:function(t){if(e.log(t),0==t.result.code){var n=t.result.userInfo;t.result.uid;delete n.password,uni.setStorageSync("user_info",n),uni.setStorageSync("uni_id_token",t.result.token),uni.setStorageSync("uni_id_token_expired",t.result.tokenExpired),uni.setStorageSync("user_role",t.result.userInfo.role),uni.setStorageSync("user_nickname",t.result.userInfo.nickname),uni.showToast({title:"登录成功"}),uni.switchTab({url:"../index/index"})}else uni.showToast({icon:"none",title:t.result.msg})},fail:function(e){uni.showToast({icon:"none",title:"登录失败"})}})},register:function(){i.callFunction({name:"user-center",data:{action:"register",params:{username:this.username,password:this.password,needPermission:!0}},success:function(e){uni.showModal({showCancel:!1,content:JSON.stringify(e.result.message)}),uni.setStorageSync("uni_id_token",e.result.token),uni.setStorageSync("uni_id_token_expired",e.result.tokenExpired),uni.setStorageSync("user_role",e.result.userInfo.role),uni.setStorageSync("user_nickname",e.result.userInfo.nickname)},fail:function(t){e.error(t),uni.showModal({showCancel:!1,content:"注册失败，请稍后再试"})}})}}};t.default=r}).call(this,n("5a52")["default"],n("a9ff")["default"])}}]);