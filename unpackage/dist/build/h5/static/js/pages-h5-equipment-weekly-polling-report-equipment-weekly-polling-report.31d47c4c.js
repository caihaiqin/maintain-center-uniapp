(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-h5-equipment-weekly-polling-report-equipment-weekly-polling-report"],{"0525f":function(e,t,n){"use strict";var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.getPollingReport=void 0;var o=a(n("78bd")),i=function(e,t,n,a){var i={url:"/report",method:"POST",responseType:"arraybuffer",headers:{Accept:"application/pdf"},data:{type:e,faultList:a,equipmentList:t,coverInfo:n}};return(0,o.default)(i)};t.getPollingReport=i},"338c":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{},[n("h5-header"),n("v-uni-web-view",{staticStyle:{width:"100%","margin-top":"60px"},attrs:{src:e.pdfUrl}})],1)},i=[]},"3f0a":function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEquipmentInfoById=t.updateEquipmentInfoBySerialNum=t.getEquipmentInfoByDep=t.getEquipmentInfo=t.getEquipmentCount=t.addEquipmentInfo=t.getEquipmentBySerialNumber=void 0;var o=n("ed3f"),i=e.database(),r=i.collection("equipments"),l=function(e){return r.where({serial_number:e}).get()};t.getEquipmentBySerialNumber=l;var u=function(){return r.count()};t.getEquipmentCount=u;var s=function(e){return a.log(o.PAGE_SIZE),r.skip(o.PAGE_SIZE*(e-1)).limit(o.PAGE_SIZE).orderBy("_id","desc").get()};t.getEquipmentInfo=s;var c=function(e,t){return r.where({department:e}).skip(100*(t-1)).limit(100).orderBy("_id","desc").get()};t.getEquipmentInfoByDep=c;var f=function(e){return r.add(e)};t.addEquipmentInfo=f;var d=function(e,t){return r.where({serial_number:e}).update(t)};t.updateEquipmentInfoBySerialNum=d;var m=function(e){return r.doc(e).remove()};t.deleteEquipmentInfoById=m}).call(this,n("a9ff")["default"],n("5a52")["default"])},"454c":function(e,t,n){"use strict";var a=n("abbf"),o=n.n(a);o.a},"4d6b":function(e,t,n){"use strict";(function(e,a){n("99af"),Object.defineProperty(t,"__esModule",{value:!0}),t.getEquipmentAndPollingList=t.getAlarmAndFaultCount=t.getEqPollingCount=t.getNetEqPollingList=t.getEquipmentInfoFault=void 0;var o=e.database(),i=o.command,r=o.collection("network-equipment-polling"),l=e.database(),u=l.collection("network-equipment-polling,equipments"),s=function(e){return r.skip(10*e).limit(10).orderBy("_id","desc").get()};t.getNetEqPollingList=s;var c=function(e,t,n){a.log("beginDate,endDate",t,n);var o=new Date(t).getTime(),i=new Date(n).getTime();a.log("newBeginDate,newEndDate",o,i,i-o);var r='serial_number.department == "'.concat(e,'" && totality=="异常" && polling_date_timestamp>').concat(o," && polling_date_timestamp<").concat(i);return a.log(r),u.where(r).field("polling_date,totality,abnormal_detail,serial_number{serial_number,department,machine_room,cabinet,model}").get()};t.getEquipmentAndPollingList=c;var f=function(){return r.count()};t.getEqPollingCount=f;var d=function(){return r.groupBy("totality").groupField("sum(alarm) as alarmCount,sum(fault) as faultCount").get()};t.getAlarmAndFaultCount=d;var m=function(e){return r.where(i.and({department:e},{totality:"异常"})).orderBy("_id","desc").get()};t.getEquipmentInfoFault=m}).call(this,n("a9ff")["default"],n("5a52")["default"])},"78bd":function(e,t,n){"use strict";(function(e){n("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var a=n("79ca");function o(t){return new Promise((function(n,o){e.log("请求数据",a.BASE_URL+t.url),uni.request({url:a.BASE_URL+t.url,method:t.method||"GET",data:t.data||{},success:n,fail:o})}))}}).call(this,n("5a52")["default"])},"79ca":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILESERVER_URL=t.BASE_URL=void 0;var a="http://81.68.227.246:8000";t.BASE_URL=a;var o="http://81.68.227.246:8000";t.FILESERVER_URL=o},"98c6":function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"H5Header",data:function(){return{changePswDialog:!1,nickName:"",avatarUrl:"",wxName:"",form:{oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""},formLabelWidth:"120px"}},mounted:function(){var e=uni.getStorageSync("user_info");this.nickName=e.nickname,this.avatarUrl=e.avatarUrl,this.wxName=e.wxname},methods:{changePswCommit:function(){var t=this;e.log("修改密码提交"),this.form.newPsw===this.form.newPswConfirm?(e.log("调用修改接口"),n.callFunction({name:"user-center",data:{action:"updatePwd",params:{oldPassword:this.form.oldPsw,newPassword:this.form.newPsw}},success:function(n){e.log("res",n),0==n.result.code?(e.log("更新成功"),uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),t.changePswDialog=!1,t.$notify({title:"修改成功",duration:2e3,type:"success",position:"bottom-right"}),setTimeout((function(){uni.navigateTo({url:"/pages/login/login"})}),1e3)):(t.$notify({title:"错误",duration:2e3,type:"error",message:n.result.message,position:"bottom-right"}),e.log(n.result.message))},fail:function(t){e.log(t),this.$notify({title:"错误",duration:2e3,type:"error",message:t,position:"bottom-right"})}})):this.form.tickMessage="两次输入的密码不一致"},backClick:function(){uni.navigateBack({})},handleCommand:function(t){e.log(t),"changePsw"===t&&(this.changePswDialog=!0,this.form={oldPsw:"",newPsw:"",newPswConfirm:"",tickMessage:""}),"logout"===t&&n.callFunction({name:"user-center",data:{action:"logout"},success:function(e){uni.removeStorageSync("uni_id_token"),uni.removeStorageSync("uni_id_token_expired"),uni.removeStorageSync("user_role"),uni.removeStorageSync("user_nickname"),uni.removeStorageSync("user_info"),uni.removeStorageSync("userProfile"),uni.reLaunch({url:"/pages/login/login"})}})}}};t.default=a}).call(this,n("5a52")["default"],n("a9ff")["default"])},a9b9:function(e,t,n){"use strict";n.r(t);var a=n("e608"),o=n("b7ef");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("454c");var r,l=n("f0c5"),u=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"a62ee596",null,!1,a["a"],r);t["default"]=u.exports},abbf:function(e,t,n){var a=n("befc");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("69c8c86d",a,!0,{sourceMap:!1,shadowMode:!1})},b0a1:function(e,t,n){"use strict";n.r(t);var a=n("338c"),o=n("cf87");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var r,l=n("f0c5"),u=Object(l["a"])(o["default"],a["b"],a["c"],!1,null,"649a27d9",null,!1,a["a"],r);t["default"]=u.exports},b7ef:function(e,t,n){"use strict";n.r(t);var a=n("98c6"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},befc:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,".el-header[data-v-a62ee596]{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:rgba(51,51,51,.95);color:#afafaf;line-height:60px}.name[data-v-a62ee596]{padding:0 %?10?%}.back[data-v-a62ee596]{padding:%?20?%}.setting[data-v-a62ee596]{padding:%?20?%}.back[data-v-a62ee596]:hover{color:#6fe9d2}",""]),e.exports=t},cf87:function(e,t,n){"use strict";n.r(t);var a=n("e923"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},e608:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("el-container",[n("el-header",{staticClass:"header uni-flex",staticStyle:{"text-align":"right","font-size":"12px"}},[n("v-uni-view",{staticClass:"back iconfont icon-shangyige",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.backClick.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"uni-flex flex-center"},[n("el-dropdown",{on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCommand.apply(void 0,arguments)}}},[n("i",{staticClass:"el-icon-setting setting",staticStyle:{"margin-right":"15px",color:"#afafaf"}}),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"changePsw"}},[e._v("修改密码")]),n("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1),e.wxName?e._e():n("span",{staticClass:"name"},[e._v(e._s(e.nickName))]),e.wxName?n("span",{staticClass:"name"},[e._v(e._s(e.wxName))]):e._e(),e.avatarUrl?n("el-avatar",{attrs:{shape:"circle",size:40,fit:"contain",src:e.avatarUrl}}):e._e()],1)],1),n("el-dialog",{attrs:{title:"修改密码",visible:e.changePswDialog,center:!0},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=t}}},[n("el-form",{attrs:{model:e.form}},[n("el-form-item",{attrs:{label:"原密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.oldPsw,callback:function(t){e.$set(e.form,"oldPsw",t)},expression:"form.oldPsw"}})],1),n("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPsw,callback:function(t){e.$set(e.form,"newPsw",t)},expression:"form.newPsw"}})],1),n("el-form-item",{attrs:{label:"确认新密码","label-width":e.formLabelWidth}},[n("el-input",{attrs:{autocomplete:"off","show-password":!0},model:{value:e.form.newPswConfirm,callback:function(t){e.$set(e.form,"newPswConfirm",t)},expression:"form.newPswConfirm"}})],1),e.form.tickMessage?n("el-form-item",{attrs:{label:"提示:","label-width":e.formLabelWidth}},[n("v-uni-text",{staticClass:"font-size-22",staticStyle:{color:"#FF3333"}},[e._v(e._s(e.form.tickMessage))])],1):e._e()],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswDialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changePswCommit.apply(void 0,arguments)}}},[e._v("确 定")])],1)],1)],1)],1)},i=[]},e923:function(e,t,n){"use strict";(function(e){var a=n("4ea4");n("99af"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("2909"));n("96cf");var i=a(n("1da1")),r=a(n("a9b9")),l=n("0525f"),u=n("3f0a"),s=n("4d6b"),c=(n("ed3f"),{components:{H5Header:r.default},data:function(){return{list:[],pdfUrl:""}},onLoad:function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(n){var a,i,r,c,f,d=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=uni.getStorageSync("coverInfo"),e.log("coverInfo",a),uni.showLoading({title:"正在生成PDF"}),t.next=5,(0,s.getEquipmentAndPollingList)(a.department,a.beginDate,a.endDate);case 5:return i=t.sent,e.log("faultList",i.result.data),r=[],c=1,t.next=11,(0,u.getEquipmentInfoByDep)(a.department,1);case 11:f=t.sent;case 12:if(!(f.result.data.length>0)){t.next=21;break}return c++,e.log("page",c),r=[].concat((0,o.default)(r),(0,o.default)(f.result.data)),t.next=18,(0,u.getEquipmentInfoByDep)(a.department,c);case 18:f=t.sent,t.next=12;break;case 21:e.log("equipmentList",r),(0,l.getPollingReport)(n.reportType,r,a,i.result.data).then((function(e){e.err?uni.showToast({title:e.message,icon:"none",duration:2e3}):(d.pdfUrl="http://81.68.227.246:8000/pdf/index.pdf",uni.hideLoading())}));case 23:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),methods:{}});t.default=c}).call(this,n("5a52")["default"])},ed3f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_DEPARTMENT=t.REPORT_CYCLE=t.CYCLE=t.DEPARTMENT=t.SMS_CONFIG=t.PAGE_SIZE=t.ANALYTICS_LINE_COLOR=t.LOCATION_RADIUS=void 0;var a=5e4;t.LOCATION_RADIUS=a;var o=["#5c8cd8","#5c9f70","#e9a943","#a42516","#d155b4","#ffffff","#323864"];t.ANALYTICS_LINE_COLOR=o;var i=15;t.PAGE_SIZE=i;var r={appid:"__UNI__DC62158",smsKey:"5e0b77dc76d4f501b4fff3b7d4c68854",smsSecret:"a683377f64ff7775354fe3f1fd625a86",templateId:"12103"};t.SMS_CONFIG=r;var l=[{value:"datacenter",label:"IDC部"},{value:"network",label:"网络部"},{value:"bigdata",label:"大数据部"},{value:"cloud",label:"云平台部"},{value:"services",label:"服务台"}];t.DEPARTMENT=l;var u=[{value:"month",label:"月"},{value:"week",label:"周"},{value:"quarter",label:"季度"}];t.CYCLE=u;var s={week:"周",month:"月",quarter:"季度"};t.REPORT_CYCLE=s;var c={network:"网络部",datacenter:"IDC部",bigdata:"大数据部",cloud:"云平台部",services:"服务台"};t.REPORT_DEPARTMENT=c}}]);