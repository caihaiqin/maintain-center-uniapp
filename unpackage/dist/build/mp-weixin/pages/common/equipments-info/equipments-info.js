(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/equipments-info/equipments-info"],{"0c43":function(e,t,n){"use strict";n.r(t);var o=n("c3db"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},1647:function(e,t,n){"use strict";(function(e){n("2249");o(n("66fd"));var t=o(n("a69b"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"1e83":function(e,t,n){"use strict";var o;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},a=[]},26080:function(e,t,n){"use strict";var o=n("ef23"),i=n.n(o);i.a},3422:function(e,t,n){},4943:function(e,t,n){"use strict";var o=n("e6e5"),i=n.n(o);i.a},"4d2f":function(e,t,n){"use strict";n.r(t);var o=n("8d27"),i=n("0c43");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("e230");var r,u=n("f0c5"),s=Object(u["a"])(i["default"],o["b"],o["c"],!1,null,"805b92dc",null,!1,o["a"],r);t["default"]=s.exports},"8b93":function(e,t,n){"use strict";n.r(t);var o=n("fac7"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},"8d27":function(e,t,n){"use strict";var o;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},a=[]},a69b:function(e,t,n){"use strict";n.r(t);var o=n("1e83"),i=n("8b93");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("4943"),n("26080");var r,u=n("f0c5"),s=Object(u["a"])(i["default"],o["b"],o["c"],!1,null,"5e13812a",null,!1,o["a"],r);t["default"]=s.exports},c3db:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"AddEquipment",props:{areaInfo:{type:Array}},data:function(){return{departmentIndex:0,machineRoomIndex:0,typeIndex:0,equipmentType:["网络","服务器"],departmentInfo:["IDC部","网络部","云平台部","大数据部","综合部"],fields:[["cabinet","机柜"],["name","设备名称"],["model","设备型号"],["grade","设备等级"],["manage_ip","管理地址"],["versions","软件版本"]],equipmentInfo:{department:"",system:"",address:"",machine_room:"",cabinet:"",name:"",model:"",type:"",grade:"1",manage_ip:"",versions:""}}},methods:{departmentIndexPickerChange:function(e){console.log("picker发送选择改变，携带值为",e.target.value),this.departmentIndex=e.target.value,this.equipmentInfo.department=this.departmentInfo[this.departmentIndex]},typeIndexPickerChange:function(e){console.log("picker发送选择改变，携带值为",e.target.value),this.typeIndex=e.target.value,this.equipmentInfo.type=this.equipmentType[this.typeIndex]},machineRoomIndexPickerChange:function(e){console.log("picker发送选择改变，携带值为",e.target.value),this.machineRoomIndex=e.target.value,this.equipmentInfo.machine_room=this.areaInfo[this.machineRoomIndex].room_name,this.equipmentInfo.system=this.areaInfo[this.machineRoomIndex].location,this.equipmentInfo.address=this.areaInfo[this.machineRoomIndex].address},addEquipmentClick:function(){console.log(this.equipmentInfo),this.equipmentInfo.department||(this.equipmentInfo.department=this.departmentInfo[this.departmentIndex]),this.equipmentInfo.machine_room||(this.equipmentInfo.machine_room=this.areaInfo[this.machineRoomIndex].room_name,this.equipmentInfo.system=this.areaInfo[this.machineRoomIndex].location,this.equipmentInfo.address=this.areaInfo[this.machineRoomIndex].address),this.equipmentInfo.type||(this.equipmentInfo.type=this.equipmentType[this.typeIndex]),this.$emit("addEquipmentClick",this.equipmentInfo)},reback:function(){e.navigateBack({})}}};t.default=n}).call(this,n("543d")["default"])},e230:function(e,t,n){"use strict";var o=n("3422"),i=n.n(o);i.a},e6e5:function(e,t,n){},ef23:function(e,t,n){},fac7:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=c(n("4d2f")),i=c(n("1c0b")),a=(c(n("5e56")),n("5822")),r=n("ed3f"),u=n("3f0a"),s=n("d7c2");function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){n.e("components/content/equipments/equipment-info/equipment-info").then(function(){return resolve(n("097a"))}.bind(null,n)).catch(n.oe)},p=function(){Promise.all([n.e("common/vendor"),n.e("components/content/equipments/equipment-polling/equipment-polling")]).then(function(){return resolve(n("9ddb5"))}.bind(null,n)).catch(n.oe)},h={data:function(){return{areaInfo:[],equipmentInfo:[],showControl:{equipmentPolling:!1,equipmentInfo:!0,addEquipment:!1},markers:[],latitude:"",longitude:"",equipmentLatitude:"",equipmentLongitude:"",distance:0,rgcData:{},fields:[["department","部门"],["system","地点"],["machine_room","机房"],["cabinet","机柜"],["name","设备名称"],["model","设备型号"],["type","设备类型"],["grade","设备等级"],["manage_ip","管理地址"],["versions","软件版本"]]}},components:{EquipmentInfo:m,EquipmentPolling:p,AddEquipment:o.default},methods:{addEquipmentClick:function(t){var n=this,o=d(d({},this.equipmentInfo[0]),t);this.equipmentInfo[0]=d({},o),(0,u.addEquipmentInfo)(o).then((function(t){e.setStorageSync("equipmentsInfo",o),e.showToast({title:"添加成功",icon:"none",duration:1e3}),setTimeout((function(){n.showControl.addEquipment=!1,n.showControl.equipmentInfo=!0,e.switchTab({url:"/pages/index/index"})}),1e3)})).catch((function(t){e.showModal({content:t.message,showCancel:!1})}))},pollingSubmit:function(t){console.log("巡检提交",t),e.switchTab({url:"/pages/index/index"}),this.showControl[t]=!1,this.showControl.equipmentInfo=!0},pollingBackClick:function(e){console.log("返回"),this.showControl[e]=!1,this.showControl.equipmentInfo=!0},pollingClick:function(){var t=this;console.log("点击巡检","设备类型",this.equipmentInfo[0].type);var n=new i.default.BMapWX({ak:"AGsjlUHa5H8WBdN9QWQ1fOwfhSoq0GFf"});if(e.getLocation({type:"gcj02",altitude:!0,success:function(e){console.log(e),t.latitude=e.latitude,t.longitude=e.longitude,n.regeocoding({location:t.latitude+","+t.longitude,iconPath:"/static/img/map/marker_red.png",iconTapPath:"/static/img/map/marker_yellow.png",success:function(e){console.log("当前位置",e.originalData.result.formatted_address)},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}}),console.log("当前位置坐标",this.latitude,this.longitude),console.log("机房位置坐标",this.equipmentLatitude,this.equipmentLongitude),this.distance=(0,a.getGreatCircleDistance)(this.latitude,this.longitude,this.equipmentLatitude,this.equipmentLongitude),console.log("当前位置距离机房-百度api",this.distance,"米"),this.distance>r.LOCATION_RADIUS)e.showToast({title:"当前不在巡检距离范围内",icon:"none",duration:1e3});else switch(this.equipmentInfo[0].type){case"网络":this.showControl.equipmentInfo=!1,this.showControl.equipmentPolling=!0;break;case"服务器":this.showControl.equipmentInfo=!1,this.showControl.equipmentPolling=!0;break;default:break}}},onReady:function(t){var n=this,o=e.getStorageSync("equipmentsInfo");this.equipmentInfo.push(o),console.log("设备信息",this.equipmentInfo);var a=e.getStorageSync("addEquipment");if(a){var u=e.getStorageSync("user_info");(0,s.getAreaByGroup)(u.group).then((function(e){n.areaInfo=e.result.data,console.log(n.areaInfo)})).catch((function(e){console.log(e.message)})),this.showControl.equipmentInfo=!1,this.showControl.addEquipment=!0}else{var c=new i.default.BMapWX({ak:"AGsjlUHa5H8WBdN9QWQ1fOwfhSoq0GFf"}),l=o.address;console.log("equipmentAddress",l),c.geocoding({address:l,iconPath:"/static/img/map/marker_red.png",iconTapPath:"/static/img/map/marker_yellow.png",success:function(e){var t=e.wxMarkerData[0];console.log("location",t),n.equipmentLatitude=t.latitude,n.equipmentLongitude=t.longitude,t.color="#50a4ec4A",t.fillColor="#50a4ec4A",t.radius=r.LOCATION_RADIUS,t.width=20,t.height=20,t.id=1001,t.callout={content:"机房位置",color:"#f0923d",bgColor:"#ffffff",borderRadius:5,display:"ALWAYS",padding:5};var o=[];o.push(t),console.log("id",typeof o[0].id),n.markers=o}}),e.getLocation({type:"gcj02",altitude:!0,success:function(e){console.log(e),n.latitude=e.latitude,n.longitude=e.longitude,c.regeocoding({location:n.latitude+","+n.longitude,iconPath:"/static/img/map/marker_red.png",iconTapPath:"/static/img/map/marker_yellow.png",success:function(e){console.log("当前位置",e.originalData.result.formatted_address)},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}})}}};t.default=h}).call(this,n("543d")["default"])}},[[13,"common/runtime","common/vendor"]]]);