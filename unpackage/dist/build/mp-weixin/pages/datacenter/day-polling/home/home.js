(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/datacenter/day-polling/home/home"],{1086:function(n,e,o){"use strict";(function(n){o("2249");t(o("66fd"));var e=t(o("5cd8"));function t(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=o,n(e.default)}).call(this,o("543d")["createPage"])},"28b6":function(n,e,o){"use strict";var t=o("65de"),i=o.n(t);i.a},"5cd8":function(n,e,o){"use strict";o.r(e);var t=o("6f1e"),i=o("b9cc");for(var l in i)"default"!==l&&function(n){o.d(e,n,(function(){return i[n]}))}(l);o("28b6");var a,s=o("f0c5"),r=Object(s["a"])(i["default"],t["b"],t["c"],!1,null,"3b2ef959",null,!1,t["a"],a);e["default"]=r.exports},"65de":function(n,e,o){},"6f1e":function(n,e,o){"use strict";var t;o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return l})),o.d(e,"a",(function(){return t}));var i=function(){var n=this,e=n.$createElement;n._self._c},l=[]},a5f9:function(n,e,o){"use strict";(function(n,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("d7c2"),l=o("f252"),a=o("5e63"),s=o("5a05");function r(n,e,o){return e in n?Object.defineProperty(n,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[e]=o,n}var c=function(){o.e("components/common/uni-combox/uni-combox").then(function(){return resolve(o("9b36"))}.bind(null,o)).catch(o.oe)},u=function(){o.e("components/common/uni-number-box/uni-number-box").then(function(){return resolve(o("ad64"))}.bind(null,o)).catch(o.oe)},g=function(){o.e("components/common/polling-item/polling-item").then(function(){return resolve(o("9bb6"))}.bind(null,o)).catch(o.oe)},f=function(){o.e("components/common/image-upload/image-upload").then(function(){return resolve(o("80a3"))}.bind(null,o)).catch(o.oe)},h={components:{imageUpload:f,pollingItem:g,uniCombox:c,uniNumberBox:u},data:function(){var n;return n={array:[{name:"资源中心"},{name:"灾备中心"}],currentRoomName:"资源中心",index:0,pollingInfo:{},enginners:[{name:"张三"},{name:"李四"},{name:"王五"}],dutyEnginner:"",handOverEnginner:"",takeOverEnginner:"",takeOverTime:"",dutyEnginnerIndex:0,handOverEnginnerIndex:0,takeOverEnginnerIndex:0},r(n,"takeOverTime",""),r(n,"abnormalDetail",""),r(n,"currentDate",""),r(n,"pollingTime","22:00"),r(n,"filePaths",[]),r(n,"filePathsBase64",[]),n},computed:{fireSystemNormal:function(){return"正常"==this.pollingInfo.fire_system},accessSystemNormal:function(){return"正常"==this.pollingInfo.access_system},upsSystemNormal:function(){return"正常"==this.pollingInfo.ups_system},gasSystemNormal:function(){return"正常"==this.pollingInfo.gas},conclusion:function(){return!("正常"==this.pollingInfo.fire_system&&"正常"==this.pollingInfo.access_system&&"正常"==this.pollingInfo.ups_system&&"正常"==this.pollingInfo.gas)}},methods:{bindPickerChange:function(n){var e=this;console.log("picker发送选择改变，携带值为",n.target.value),this.index=n.target.value,this.currentRoomName=this.array[this.index].room_name,console.log("根据选择的机房获取最近一次巡检信息"),(0,a.getPollingInfoByArea)(this.currentRoomName).then((function(n){e.pollingInfo=n.data[n.data.length-1],console.log(e.pollingInfo)})).catch((function(n){console.log(n)}))},dutyEnginnerChange:function(n){this.dutyEnginnerIndex=n.target.value,this.pollingInfo.duty_enginner=this.enginners[this.dutyEnginnerIndex].nickname,console.log("当前值班工程师选择，携带值为",n.target.value,this.dutyEnginner)},handOverEnginnerChange:function(n){this.handOverEnginnerIndex=n.target.value,this.pollingInfo.hand_over_enginner=this.enginners[this.handOverEnginnerIndex].nickname,console.log("交班工程师选择，携带值为",n.target.value,this.handOverEnginner)},takeOverEnginnerChange:function(n){this.takeOverEnginnerIndex=n.target.value,this.pollingInfo.take_over_enginner=this.enginners[this.takeOverEnginnerIndex].nickname,console.log("接班工程师选择，携带值为",n.target.value,this.takeOverEnginner)},takeOverTimeChange:function(n){this.pollingInfo.take_over_time=n.target.value},pollingTimeChange:function(n){this.pollingInfo.polling_time=n.target.value,this.pollingTime=n.target.value},toolChange:function(n,e){this.pollingInfo[e]=n.toString(),console.log(this.pollingInfo[e],e,typeof this.pollingInfo[e])},systemNormalChange:function(n,e){console.log(n,e),this.pollingInfo[e]="异常"==this.pollingInfo[e]?"正常":"异常",console.log(this.pollingInfo[e])},abnormalDetailEnter:function(n){this.pollingInfo.abnormal_detail=n.detail.value,console.log(this.pollingInfo.abnormal_detail)},redirectToHome:function(){console.log("跳转"),n.navigateBack({})},submit:function(){var e=this;this.pollingInfo.conclusion="正常"==this.pollingInfo.fire_system&&"正常"==this.pollingInfo.access_system&&"正常"==this.pollingInfo.ups_system&&"正常"==this.pollingInfo.gas?"正常":"异常",this.pollingInfo.polling_date=this.currentDate,this.pollingInfo.polling_time=this.pollingTime,this.pollingInfo.machinery_room=this.currentRoomName,console.log(this.pollingInfo),console.log(this.pollingInfo),delete this.pollingInfo._id,console.log(typeof this.pollingInfo.phone),console.log("上传图片");var o=[],i=[],l=[],a=[],s=0,r=[],c=this.filePaths.length;n.showLoading({title:"正在上传".concat(++s,"/").concat(c)});var u=(new Date).getTime();this.filePaths.forEach((function(e,o){console.log(e,o),r.push(t.uploadFile({filePath:e,cloudPath:e+".jpg"}).then((function(e){return console.log(e),n.hideLoading(),n.showLoading({title:"正在上传".concat(++s,"/").concat(c)}),e})))})),Promise.all(r).then((function(s){if(console.log(s),s.forEach((function(n,e){a.push(n.fileID),n.success?o.push(e):(i.push(n.filePath),l.push(e))})),o.length==s.length){var r=(new Date).getTime();console.log("上传时间",r-u),!1,n.hideLoading(),n.showToast({title:"图片上传成功",duration:1e3}),e.pollingInfo.fileIDs=a;var c=t.database();c.collection("pollings").add(e.pollingInfo).then((function(e){n.showToast({title:"提交成功",duration:1e3}),setTimeout((function(){n.navigateBack({})}),1e3)})).catch((function(e){n.showModal({content:e.message||"提交失败",showCancel:!1})})).finally((function(){}))}else console.log(list),n.showToast({title:"图片上传失败，请重新点击提交",icon:"none"}),e.filePaths=i}))},uploadImg:function(n,e){console.log("图片上传",n,e),this.filePaths=e,this.filePathsBase64=n}},onReady:function(){var n=this;console.log("每日巡检页面");var e=new Date,o=(0,s.dateFormat)(e,"YYYY-mm-dd,HH:MM:SS").split(",");this.currentDate=o[0],this.pollingTime=o[1],console.log("今天日期",this.currentDate),console.log("当前时间",this.pollingTime),(0,i.getAreaByGroup)(1).then((function(e){n.array=e.result.data})).catch((function(n){console.log(n)})),(0,l.getUsersByGroup)(1).then((function(e){console.log(e),n.enginners=e.result.data})).catch((function(n){console.log(n)})),(0,a.getPollingInfoByArea)(this.currentRoomName).then((function(e){console.log(e),n.pollingInfo=e.result.data.length>0?e.result.data[e.result.data.length-1]:{},console.log(n.pollingInfo)})).catch((function(n){console.log(n)}))}};e.default=h}).call(this,o("543d")["default"],o("a9ff")["default"])},b9cc:function(n,e,o){"use strict";o.r(e);var t=o("a5f9"),i=o.n(t);for(var l in t)"default"!==l&&function(n){o.d(e,n,(function(){return t[n]}))}(l);e["default"]=i.a}},[["1086","common/runtime","common/vendor"]]]);